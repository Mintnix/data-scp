' Gambas class file

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Public Version As String = Application.Version     'Version aus App holen
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

''globale Variablen sind Static - mit Fmain. aufrufen
Static Public sGlobal1 As String    'Zeile 1    -  individueller Dateimanager
Static Public sGlobal2 As String    'Zeile 2    -  individuelles Terminal 

''Variablen deklarieren, hier!
Public sDateimanager As String            'Zeile 1    -  der Dateimanager
Public sTerminal As String                'Zeile 2    -  das Terminal
Public sServerIP1 As String               'Zeile 3
Public sBenutzer1 As String               'Zeile 4
Public sPort1 As String                   'Zeile 5
Public sServerName1 As String             'Zeile 6
Public sServerIP2 As String               'Zeile 7
Public sBenutzer2 As String               'Zeile 8
Public sPort2 As String                   'Zeile 9
Public sServerName2 As String             'Zeile 10
Public sServerIP3 As String               'Zeile 11
Public sBenutzer3 As String               'Zeile 12
Public sPort3 As String                   'Zeile 13
Public sServerName3 As String             'Zeile 14
Public sServerIP4 As String               'Zeile 15
Public sBenutzer4 As String               'Zeile 16
Public sPort4 As String                   'Zeile 17
Public sServerName4 As String             'Zeile 18
Public sMinimiert As String               'Zeile 19    -  minimiert ?
Public iAktiv As String                   'Zeile 20    -  Server ausgewählt
Static Public sProgrammfarbe As String    'Zeile 21    -  soll die Hintergrundfarbe des Programms speichern

Public sServerIP As String
Public sBenutzer As String
Public sPort As String
Public sServerName As String
Public sSenden As String
Public sHolen As String


'' ---------------------------------------------Programmcode--------------------------------------------------
Public Sub Form_Close()
  ' Hier ist die Behandlung für den Programmabbruch, denn bei Klick auf X oder Alt+F4 würde sonst das TrayModul nicht geschlossen und so im Hintergrund herumgeistern. Wichtig! 
  TrayIcons.DeleteAll 
  Dateiexplorer.Delete
End

Public Sub Form_Open()
'Was soll beim Start passieren?
'1. Prüfen ob das Arbeitsverzeichnis vorhanden ist, ggf anlegen
'2. Speicherdatei vorhanden, ggf. anlegen
'3. Daten aus der Speicherdatei laden und in die Anwendung füllen

Dim hFile As Stream
Dim sLine1 As String    ' Dateimanager
Dim sLine2 As String    ' Terminal
Dim sLine3 As String    ' ServerIP
Dim sLine4 As String    ' Benutzer
Dim sLine5 As String    ' SSH Portnummer
Dim sLine6 As String    ' Servername
Dim sLine7 As String    ' ServerIP
Dim sLine8 As String    ' Benutzer
Dim sLine9 As String    ' SSH Portnummer
Dim sLine10 As String    ' Servername
Dim sLine11 As String    ' ServerIP
Dim sLine12 As String    ' Benutzer
Dim sLine13 As String    ' SSH Portnummer
Dim sLine14 As String    ' Servername
Dim sLine15 As String    ' ServerIP
Dim sLine16 As String    ' Benutzer
Dim sLine17 As String    ' SSH Portnummer
Dim sLine18 As String    ' Servername
Dim sLine19 As String    ' Tray aktiviert?
Dim sLine20 As String   ' vorheriger ausgewählter Server
Dim sLine21 As String   ' Programmfarbe


If Exist("~/DataSCP") = False Then
   Message("Konfiguration existiert noch nicht .\nBitte den Einstellungsdialog öffnen und anpassen.", "OK") 
Endif
'Konfigurationsdatei wird automatisch angelegt
If Exist("~/.datascp.txt") = False Then
   Shell "touch ~/.datascp.txt" Wait 
Endif

'hier wird geladen und in Variablen gefüllt
hFile = Open "~/.datascp.txt" For Read
   Line Input #hFile, sLine1
   Line Input #hFile, sLine2
   Line Input #hFile, sLine3
   Line Input #hFile, sLine4
   Line Input #hFile, sLine5
   Line Input #hFile, sLine6
   Line Input #hFile, sLine7
   Line Input #hFile, sLine8
   Line Input #hFile, sLine9
   Line Input #hFile, sLine10
   Line Input #hFile, sLine11
   Line Input #hFile, sLine12
   Line Input #hFile, sLine13
   Line Input #hFile, sLine14
   Line Input #hFile, sLine15
   Line Input #hFile, sLine16
   Line Input #hFile, sLine17
   Line Input #hFile, sLine18
   Line Input #hFile, sLine19
   Line Input #hFile, sLine20
   Line Input #hFile, sLine21
   
   sDateimanager = sLine1
   sTerminal = sLine2
   sServerIP1 = sLine3
   sBenutzer1 = sLine4
   sPort1 = sLine5
   sServerName1 = sLine6
   sServerIP2 = sLine7
   sBenutzer2 = sLine8
   sPort2 = sLine9
   sServerName2 = sLine10
   sServerIP3 = sLine11
   sBenutzer3 = sLine12
   sPort3 = sLine13
   sServerName3 = sLine14
   sServerIP4 = sLine15
   sBenutzer4 = sLine16
   sPort4 = sLine17
   sServerName4 = sLine18
   sMinimiert = sLine19
   iAktiv = sLine20
   sProgrammfarbe = sLine21
   
   
   If iAktiv = 1 Then 
   mServer1_Click() 
   mServer1.Checked = True
   Endif 
   If iAktiv = 2 Then 
   mServer2_Click()
   mServer2.Checked = True
   Endif 
   If iAktiv = 3 Then
   mServer3_Click()
   mServer3.Checked = True
   Endif 
   If iAktiv = 4 Then 
   mServer4_Click()
   mServer4.Checked = True
   Endif 
   If iAktiv = "" Then Message("Es wurde noch kein Server ausgewählt,\noder es sind noch keine Server in den \nEinstellungen eingetragen.", "OK") 

   'Menü mit den Namen der Server auffüllen - Gambas zeigt im Übrigen nur Menüeinträge an, die nicht "leer" sind.
   mServer1.Text = sServerName1
   mServer2.Text = sServerName2
   mServer3.Text = sServerName3
   mServer4.Text = sServerName4
   'Standardprogrammfarbe Abfrage
   If sProgrammfarbe = "" Then sProgrammfarbe = 12582911
   'Programmfarbe einstellen
   FMain.Background = sProgrammfarbe
   'Print sLine21 '' ist die Programmfarbe 
   Print sProgrammfarbe & " eingestellte Programmfarbe  (12582911 entspricht der Standardfarbe)"   
   Wait 

End


Public Sub FirstInit()
   ''Check nach erstem Programmaufruf mit ggf. Minimierung der Anwendung als Trayicon in die Leiste
   ' funktioniert über den Trick des Programmaufrufes über ein anderes Modul als Startklasse - Dank an Koko
    If sMinimiert = "minimiert" Then 
         'Menu8.Show
         'Menu9.Show
         Menu7.Enabled = False
         mServerliste.Enabled = False
         'Menu10.Hide
         'If FMain.sGlobal3 = "minimiert" Then Menu10.Checked = True          
         Menu10.Checked = True
         Menu10.Show    
         'Me.Width = 378
         'Me.Height = 333
         Me.Visible = False
         TrayIcon1.Show
    Endif
End

Public Sub Speicherroutine()
   'Speicherfunktion   
  File.Save("~/.datascp.txt", sDateimanager & gb.NewLine & sTerminal & gb.NewLine & sServerIP1 & gb.NewLine & sBenutzer1 & gb.NewLine & sPort1 & gb.NewLine & sServerName1 & gb.NewLine & sServerIP2 & gb.NewLine & sBenutzer2 & gb.NewLine & sPort2 & gb.NewLine & sServerName2 & gb.NewLine & sServerIP3 & gb.NewLine & sBenutzer3 & gb.NewLine & sPort3 & gb.NewLine & sServerName3 & gb.NewLine & sServerIP4 & gb.NewLine & sBenutzer4 & gb.NewLine & sPort4 & gb.NewLine & sServerName4 & gb.NewLine & sMinimiert & gb.NewLine & iAktiv & gb.NewLine & sProgrammfarbe & gb.NewLine)
End


Public Sub Button2_Click()
   ''Daten zum Server senden →
   If sTerminal = "xfce4-terminal" Then 
      Shell sTerminal & " -x" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Wait 
   Else If sTerminal = "konsole" Then
      Shell sTerminal & " -e" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Wait 
   Else 
      Shell sTerminal & " --" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Wait 
   Catch    'Fehlerbehandlung hier ? oder wie unten nach endif ?
      If Error Then Message("Fehler", "OK")
   Endif 
End

Public Sub Button1_Click()
   ''Daten vom Server abholen ←
   If sTerminal = "xfce4-terminal" Then
      Shell sTerminal & " -x" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait 
   Else If sTerminal = "konsole" Then 
      Shell sTerminal & " -e" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait 
   Else
      Shell sTerminal & " --" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait
   Endif 
   Catch    'Fehlerbehandlung
    If Error Then Message("Fehler", "ok") 
End


Public Sub Button4_Click()
   'Einstellungsbutton öffnet Abfragedialog
   AbfrageForm.Show
   
End

Public Sub Button8_Click()
   'Den Uploadordner öffnen
    Dateiexplorer.Show
End

Public Sub Form_DblClick()
   'welcher Desktop ?
   Message("Sie verwenden " & Desktop.Type, "OK")
End

Public Sub Form_KeyPress()
   ''Hilfe über F1 anzeigen
   If Key.Code = Key.F1 Then 
'  IF Key.Code = Key.F1 THEN AND FHelp.Closed = FALSE 
     Form1.Show 
   Endif 
   If Key.Code = Key.ESC And Form1.Closed = False Then 
     Form1.Delete 
   Endif 
End


Public Sub Button3_Click()
   ''Programm schließen
   Speicherroutine()
   TrayIcons.DeleteAll
   Dateiexplorer.Delete
   Me.Close
End


Public Sub Label2_MouseDown()
   ' öffnet den eingestellten Standardbrowser, Desktop.Open ist eine bessere Wahl als z.B. shell "firefox"
   If Desktop.Type = "KDE" Then 
      Shell "firefox https://openyourlinux.blogspot.com/p/data-scp-22x.html"
   Else 
      Desktop.Open("https://openyourlinux.blogspot.com/p/data-scp-22x.html") 
   Endif 
End


Public Sub Menu4_Click()
   '' Über... Button Versionsanzeige
   Message("Hilfe im Hauptfenster über F1 oder im Menü.\n\nProgramm Version  " & Version, "OK") 
End

Public Sub Menu3_Click()
   'Einstellungsbutton öffnet Abfragedialog
   AbfrageForm.Show
End

Public Sub Menu5_Click()
   'Programm schließen
   TrayIcons.DeleteAll
   Dateiexplorer.Delete
   Me.Close
End

Public Sub TrayIcon1_Click()
   '' Den Uploadordner öffnen
   'Shell sDateimanager & " -- ~/DataSCP"
   Dateiexplorer.Show
End

Public Sub Menu2_Click()
   'Hilfe F1 anzeigen
   Form1.Show
End

Public Sub Menu7_Click()
   ''Programm ins Tray minimieren und Menü auffüllen
   Menu7.Enabled = False
   mServerliste.Enabled = False
   If sMinimiert = "minimiert" Then Menu10.Checked = True
   TrayIcon1.Show
   Me.Visible = False
End

Public Sub TrayIcon1_MiddleClick()
   ''Programm wieder anzeigen und Menü anpassen
    If sMinimiert = "minimiert" Then Menu10.Checked = True
    Menu7.Enabled = True
    mServerliste.Enabled = True
    TrayIcon1.Hide
    Me.Visible = True
End


Public Sub Menu8_Click()
   ''Daten senden über Trayicon
   If sTerminal = "xfce4-terminal" Then 
      Shell sTerminal & " -x" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Wait 
   Else If sTerminal = "konsole" Then
      Shell sTerminal & " -e" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Wait 
   Else 
      Shell sTerminal & " --" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Wait
   Endif 
End

Public Sub Menu9_Click()
   ''Daten abrufen über Trayicon
   If sTerminal = "xfce4-terminal" Then
      Shell sTerminal & " -x" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait 
   Else If sTerminal = "konsole" Then 
      Shell sTerminal & " -e" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait 
   Else
      Shell sTerminal & " --" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait
   Endif 
End


Public Sub Menu10_Click()
   'Menüpunkt immer minimiert 
   If Menu10.Checked = False Then sMinimiert = "maximiert" Else sMinimiert = "minimiert"
       'File.Save("~/.datascp.txt", sDateimanager & gb.NewLine & sServerIP & gb.NewLine & sBenutzer & gb.NewLine & sTerminal & gb.NewLine & sPort & gb.NewLine & sMinimiert)
       Speicherroutine()
    Catch
    If Error Then Message("Fehler", "ok")
   'If Error Then Return
End

Public Sub mServer1_Click()
   'Server 1 auswgewählt
   sServerIP = sServerIP1
   Print sServerIP
   sBenutzer = sBenutzer1 
   Print sBenutzer
   sPort = sPort1
   If sPort = "" Then sPort = "22"
   Print sPort
   iAktiv = 1
   sSenden = " scp -P " & sPort & " -r ~/DataSCP "
   sHolen = " scp -P " & sPort & " -r "
   Print sSenden & "        |       " & sHolen
End

Public Sub mServer2_Click()
   'Server 2 ausgewählt
   sServerIP = sServerIP2
   Print sServerIP
   sBenutzer = sBenutzer2 
   Print sBenutzer
   sPort = sPort2
   If sPort = "" Then sPort = "22"
   iAktiv = 2
   sSenden = " scp -P " & sPort & " -r ~/DataSCP "
   sHolen = " scp -P " & sPort & " -r "
   Print sSenden & "        |       " & sHolen
End

Public Sub mServer3_Click()
   'Server 3 ausgewählt
   sServerIP = sServerIP3
   Print sServerIP
   sBenutzer = sBenutzer3 
   Print sBenutzer
   sPort = sPort3
   If sPort = "" Then sPort = "22"
   iAktiv = 3
   sSenden = " scp -P " & sPort & " -r ~/DataSCP "
   sHolen = " scp -P " & sPort & " -r "
   Print sSenden & "        |       " & sHolen
End

Public Sub mServer4_Click()
   'Server 4 ausgewählt
   sServerIP = sServerIP4
   Print sServerIP
   sBenutzer = sBenutzer4 
   Print sBenutzer
   sPort = sPort4
   If sPort = "" Then sPort = "22"
   iAktiv = 4
   sSenden = " scp -P " & sPort & " -r ~/DataSCP "
   sHolen = " scp -P " & sPort & " -r "
   Print sSenden & "        |       " & sHolen
End 
