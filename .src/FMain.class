' Gambas class file

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Public Version As String = Application.Version     'Version aus App holen
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

''globale Variablen sind Static - mit Fmain. aufrufen
'Static Public sManager As String    'globale Dateimanager Variable
Static Public sGlobal1 As String    'Zeile 1    -  individueller Dateimanager
Static Public sGlobal2 As String    'Zeile 4    -  individuelles Terminal 

''Variablen deklarieren, hier???'''''''''''''''''''''''
Public sDateimanager As String      'Zeile 1
Public sServerIP As String          'Zeile 2
Public sBenutzer As String          'Zeile 3
Public sTerminal As String          'Zeile 4 
Public sPort As String              'Zeile 5
Public sMinimiert As String           'Zeile 6    -  minimiert ?
Public sSenden As String
Public sHolen As String






Public Sub Form_Open()

'Was soll beim Start passieren?
'1. Prüfen ob das Arbeitsverzeichnis vorhanden ist, ggf anlegen
'2. Speicherdatei vorhanden, ggf. anlegen
'3. Daten aus der Speicherdatei laden und in die Anwendung füllen
'
Dim hFile As Stream
Dim sLine As String     ' Dateimanager
Dim sLine2 As String    ' ServerIP
Dim sLine3 As String    ' Benutzername
Dim sLine4 As String    ' Terminal
Dim sLine5 As String    ' SSH Portnummer
Dim sLine6 As String    ' Tray aktiviert?


'ComboBox1.Text = sDateimanager
'TextBox1.Text = sServerIP
'TextBox2.Text = sBenutzer


If Exist("~/DataSCP") = False Then
   Message("Konfiguration existiert noch nicht .\nBitte den Einstellungsdialog öffnen und anpassen.", "OK") 

   
Endif


''Konfigurationsdatei wird automatisch angelegt
If Exist("~/.datascp.txt") = False Then
   Shell "touch ~/.datascp.txt" Wait
Endif

'If Exist("~/Schreibtisch/DataSCP") = True Then Message("Der Uploadordner existiert bereits", "OK")

'hier wird geladen und in Variablen gefüllt
hFile = Open "~/.datascp.txt" For Read

   Line Input #hFile, sLine
   Line Input #hFile, sLine2
   Line Input #hFile, sLine3
   Line Input #hFile, sLine4
   Line Input #hFile, sLine5
   Line Input #hFile, sLine6

   Print sLine, sLine2, sLine3, sLine4, sLine5, sLine6
   
   sDateimanager = sLine
   sServerIP = sLine2
   sBenutzer = sLine3
   sTerminal = sLine4
   sPort = sLine5
   sMinimiert = sLine6
      
   
   'Menübefehle nicht alle anzeigen!
    'Menu8.Hide
    'Menu9.Hide
    'Menu10.Hide

   'SSH Portabfrage
   If sLine5 = "" Then sPort = "22"
   sSenden = " scp -P " & sPort & " -r ~/DataSCP "
   sHolen = " scp -P " & sPort & " -r "
   Print sSenden
   Print sHolen
   

End


''Check nach erstem Programmaufruf mit ggf. Minimierung der Anwendung als Trayicon in die Leiste
' funktioniert über den Trick des Programmaufrufes über ein andres Modul als Startklasse - Dank an Koko
Public Sub FirstInit()
   
    If sMinimiert = "minimiert" Then 
         'Menu8.Show
         'Menu9.Show
         Menu7.Enabled = False
         'Menu10.Hide
         'If FMain.sGlobal3 = "minimiert" Then Menu10.Checked = True          
         Menu10.Checked = True
         Menu10.Show    
         'Me.Width = 378
         'Me.Height = 333
         Me.Visible = False
         TrayIcon1.Show
      
    Endif
   
End




Public Sub Button2_Click()
   ''Daten zum Server senden →
   
   'bisheriger Befehl
   'If sTerminal = "xfce4-terminal" Then Shell sTerminal & " -x scp -r ~/DataSCP" & " " & sBenutzer & "@" & sServerIP & ":~/" Else Shell sTerminal & " -- scp -r ~/DataSCP" & " " & sBenutzer & "@" & sServerIP & ":~/" Wait
   
   'neuer Befehl
   If sTerminal = "xfce4-terminal" Then Shell sTerminal & " -x" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Else Shell sTerminal & " --" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Wait 
   
           
End

Public Sub Button1_Click()
   ''Daten vom Server abholen ←
               
   'bisheriger Befehl
   'If sTerminal = "xfce4-terminal" Then Shell sTerminal & " -x scp -r " & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Else Shell sTerminal & " -- scp -r " & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait 
   
   'neuer Befehl
   If sTerminal = "xfce4-terminal" Then Shell sTerminal & " -x" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Else Shell sTerminal & " --" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait
     
   
End


Public Sub Button4_Click()
   'Einstellungsbutton öffnet Abfragedialog
   AbfrageForm.Show
   
End

Public Sub Button8_Click()
   'Den Uploadordner öffnen
   Shell sDateimanager & " -- ~/DataSCP"
 
End

Public Sub Form_DblClick()

   Message("Sie verwenden " & sDateimanager, "OK")
   
End

Public Sub Form_KeyPress()
   ''Hilfe über F1 anzeigen
   If Key.Code = Key.F1 Then 
'  IF Key.Code = Key.F1 THEN AND FHelp.Closed = FALSE 
     Form1.Show 
   Endif 
   If Key.Code = Key.ESC And Form1.Closed = False Then 
     Form1.Delete 
   Endif 

End


Public Sub Button3_Click()
   ''Programm schließen
   Shell sDateimanager & " -q" Wait
   TrayIcons.DeleteAll
   Me.Close
        
End


Public Sub Label2_MouseDown()

   Shell "firefox  https://openyourlinux.blogspot.com/p/data-scp-version-21x-bringt-einige.html"

End


Public Sub Menu4_Click()
   '' Über... Button Versionsanzeige
   Message("Hilfe im Hauptfenster über F1 oder im Menü.\n\nProgramm Version  " & Version, "OK")

End

Public Sub Menu3_Click()
   'Einstellungsbutton öffnet Abfragedialog
   AbfrageForm.Show

End

Public Sub Menu5_Click()
   'Programm schließen
   Shell sDateimanager & " -q" Wait
   TrayIcons.DeleteAll
   Me.Close

End

Public Sub TrayIcon1_Click()
   '' Den Uploadordner öffnen
   Shell sDateimanager & " -- ~/DataSCP"

End

Public Sub Menu2_Click()
   'Hilfe F1 anzeigen
   Form1.Show

End

Public Sub Menu7_Click()
   ''Programm ins Tray minimieren und Menü auffüllen
   Menu7.Enabled = False
   If sMinimiert = "minimiert" Then Menu10.Checked = True
   TrayIcon1.Show
   Me.Visible = False
   
End

Public Sub TrayIcon1_MiddleClick()
   ''Programm wieder anzeigen und Menü anpassen
    If sMinimiert = "minimiert" Then Menu10.Checked = True
    Menu7.Enabled = True
    TrayIcon1.Hide
    Me.Visible = True
   
End



Public Sub Menu8_Click()
   ''Daten senden über Trayicon
   If sTerminal = "xfce4-terminal" Then Shell sTerminal & " -x" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Else Shell sTerminal & " --" & sSenden & sBenutzer & "@" & sServerIP & ":~/" Wait

End

Public Sub Menu9_Click()
   ''Daten vom Server abrufen über Trayicon
   If sTerminal = "xfce4-terminal" Then Shell sTerminal & " -x" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Else Shell sTerminal & " --" & sHolen & sBenutzer & "@" & sServerIP & ":~/DataSCP/ ~/" Wait

End


Public Sub Menu10_Click()
   'Menüpunkt immer minimiert 
   If Menu10.Checked = False Then sMinimiert = "maximiert" Else sMinimiert = "minimiert"
       File.Save("~/.datascp.txt", sDateimanager & gb.NewLine & sServerIP & gb.NewLine & sBenutzer & gb.NewLine & sTerminal & gb.NewLine & sPort & gb.NewLine & sMinimiert)
    Catch
   ' If Error Then Message("Fehler", "ok")
   If Error Then Return

End
